name: Editor Builds
on:
  - push
  - pull_request

jobs:
  build_vscode_extension:
    runs-on: ubuntu-latest
    name: Build VsCode Extension
    steps:
      - uses: actions/checkout@v3
      - name: Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: Install Dependencies
        run: yarn
        working-directory: Hdl21SchematicEditor/
      - name: Build & Package VsCode Extension
        run: yarn package
        working-directory: Hdl21SchematicEditor/packages/VsCodePlugin/

  # FIXME: these three "build_app" jobs can probably be a single job with a matrix
  
  build_app_on_mac:
    runs-on: macos-latest
    name: Build App on Mac
    steps:
      - uses: actions/checkout@v3
      - name: Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: Install Dependencies
        run: yarn
        working-directory: Hdl21SchematicEditor/
      - name: Make App
        run: yarn make
        working-directory: Hdl21SchematicEditor/packages/EditorApp/

  build_app_on_windows:
    runs-on: windows-latest
    name: Build App on Windows
    steps:
      - uses: actions/checkout@v3
      - name: Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: Install Dependencies
        run: yarn
        working-directory: Hdl21SchematicEditor/
      - name: Make App
        run: yarn make
        working-directory: Hdl21SchematicEditor/packages/EditorApp/

  build_app_on_linux:
    runs-on: ubuntu-latest
    name: Build App on Linux
    steps:
      - uses: actions/checkout@v3
      - name: Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 18
      - name: Install Dependencies
        run: yarn
        working-directory: Hdl21SchematicEditor/
      - name: Make App
        run: yarn make
        working-directory: Hdl21SchematicEditor/packages/EditorApp/
    continue-on-error: true # FIXME! haven't gotten this one working yet

  python_importer_tests:
    runs-on: ubuntu-latest
    name: Python Importer Test Suite
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.7", "3.8", "3.9", "3.10"]

    steps:
      - uses: actions/checkout@v3

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install dependencies
        run: pip install -e ".[dev]"

      - name: Test with pytest
        run: pytest --verbose

      - name: Black Formatting Check
        uses: psf/black@stable
        with:
          version: "22.6"
